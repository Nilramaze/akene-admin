const __vite__fileDeps=["ConfigureTheView-BuULTlH7-BJsSUXWG.js","strapi-BXowZxcM.js","strapi-COJtagOC.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{d as J,r as M,bA as Te,fi as $e,aR as T,f as C,fj as c,j as e,P as L,R as Pe,p as ue,B as $,T as Y,a4 as Ue,fk as Ve,ao as je,br as be,fl as Qe,fm as ze,fn as Oe,fo as Ge,fp as Ne,fq as A,fr as qe,L as I,ac as ye,fs as He,U as q,ba as _e,by as Me,d0 as We,ft as D,fu as Ke,dq as Je,bi as Ye,fv as Xe,fw as Ze,G as W,fx as es,W as ss,fy as ts,fz as as,F as P,N as ns,b6 as is,fA as os,aU as H,fB as rs,fC as ls,fD as ds,fE as cs,fF as us,c4 as gs,n as S,bh as K,am as ge,an as fs,fG as hs,fH as fe,fI as ps,fJ as ms,s as xs,a5 as js,a6 as bs,fK as ys,fL as Ms,bm as he,bl as Cs,bn as Fs,Y as y,dl as vs,fM as Ss,aV as ks,$ as Ls,a0 as ws,k as pe,fN as As,u as Es,A as Rs,g as Bs,i as Ds,fO as _,fP as Is,eK as Ts}from"./strapi-BXowZxcM.js";const $s=(s,{pathname:n,query:a})=>{const i=[{id:null,label:{id:c("plugin.name"),defaultMessage:"Media Library"},href:s?A(n,a||{}):void 0}];return s?.parent&&typeof s?.parent!="number"&&s?.parent?.parent&&i.push([]),s?.parent&&typeof s.parent!="number"&&i.push({id:s.parent.id,label:s.parent.name,href:A(n,a||{},{folder:s.parent.id?.toString(),folderPath:s.parent.path})}),s&&i.push({id:s.id,label:s.name}),i},Ps=s=>{const{id:n}=cs();return e.jsx($,{position:"relative",zIndex:2,children:e.jsx(ye,{"aria-labelledby":`${n}-title`,...s})})},Us=({selected:s,onSuccess:n})=>{const{formatMessage:a}=C(),{remove:i}=Ms(),d=async()=>{await i(s),n()};return e.jsxs(he.Root,{children:[e.jsx(he.Trigger,{children:e.jsx(S,{variant:"danger-light",size:"S",startIcon:e.jsx(Cs,{}),children:a({id:"global.delete",defaultMessage:"Delete"})})}),e.jsx(Fs,{onConfirm:d})]})},Vs=()=>{const{formatMessage:s}=C(),{toggleNotification:n}=Es(),a=Rs(),{post:i}=Bs(),o=Ds(({destinationFolderId:h,filesAndFolders:f})=>{const l=f.reduce((g,j)=>{const{id:r,type:v}=j,p=v==="asset"?"fileIds":"folderIds";return g[p]||(g[p]=[]),g[p].push(r),g},{});return i("/upload/actions/bulk-move",{...l,destinationFolderId:h})},{onSuccess(h){const{data:{data:f}}=h;f?.files?.length>0&&(a.refetchQueries([_,"assets"],{active:!0}),a.refetchQueries([_,"asset-count"],{active:!0})),a.refetchQueries([_,"folders"],{active:!0}),n({type:"success",message:s({id:c("modal.move.success-label"),defaultMessage:"Elements have been moved successfully."})})}});return{...o,move:(h,f)=>o.mutateAsync({destinationFolderId:h,filesAndFolders:f})}},Qs=({onClose:s,selected:n=[],currentFolder:a})=>{const{formatMessage:i}=C(),{data:d,isLoading:o}=Ss(),{move:u}=Vs();if(!d)return null;const h=async(l,{setErrors:g})=>{try{if(typeof l.destination!="string"){const j=l.destination.value;await u(j,n),s()}}catch(j){const r=Is(j);if(r&&"errors"in r){const v=r.errors?.reduce((p,E)=>(p[E.values?.path?.length||"destination"]=E.defaultMessage,p),{});Ts(v)||g(v)}}};if(o)return e.jsx(y.Content,{children:e.jsx(y.Body,{children:e.jsx(P,{justifyContent:"center",paddingTop:4,paddingBottom:4,children:e.jsx(ks,{children:i({id:c("content.isLoading"),defaultMessage:"Content is loading."})})})})});const f={destination:{value:a?.id||"",label:a?.name||d[0].label}};return e.jsx(y.Content,{children:e.jsx(Ls,{validateOnChange:!1,onSubmit:h,initialValues:f,children:({values:l,errors:g,setFieldValue:j})=>e.jsxs(ws,{noValidate:!0,children:[e.jsx(y.Header,{children:e.jsx(y.Title,{children:i({id:c("modal.folder.move.title"),defaultMessage:"Move elements to"})})}),e.jsx(y.Body,{children:e.jsx(W.Root,{gap:4,children:e.jsx(W.Item,{xs:12,col:12,direction:"column",alignItems:"stretch",children:e.jsxs(pe.Root,{id:"folder-destination",children:[e.jsx(pe.Label,{children:i({id:c("form.input.label.folder-location"),defaultMessage:"Location"})}),e.jsx(As,{options:d,onChange:r=>{j("destination",r)},defaultValue:typeof l.destination!="string"?l.destination:void 0,name:"destination",menuPortalTarget:document.querySelector("body"),inputId:"folder-destination",error:g?.destination,ariaErrorMessage:"destination-error"}),g.destination&&e.jsx(Y,{variant:"pi",tag:"p",textColor:"danger600",children:g.destination})]})})})}),e.jsxs(y.Footer,{children:[e.jsx(y.Close,{children:e.jsx(S,{variant:"tertiary",name:"cancel",children:i({id:"cancel",defaultMessage:"Cancel"})})}),e.jsx(S,{type:"submit",loading:o,children:i({id:"modal.folder.move.submit",defaultMessage:"Move"})})]})]})})})},zs=({selected:s=[],onSuccess:n,currentFolder:a})=>{const{formatMessage:i}=C(),[d,o]=M.useState(!1),u=()=>{o(!1),n()};return e.jsxs(y.Root,{open:d,onOpenChange:o,children:[e.jsx(y.Trigger,{children:e.jsx(S,{variant:"secondary",size:"S",startIcon:e.jsx(vs,{}),children:i({id:"global.move",defaultMessage:"Move"})})}),e.jsx(Qs,{currentFolder:a,onClose:u,selected:s})]})},Os=({selected:s=[],onSuccess:n,currentFolder:a})=>{const{formatMessage:i}=C(),d=s?.reduce(function(o,u){return u?.type==="folder"&&"files"in u&&u?.files&&"count"in u.files?o+u?.files?.count:o+1},0);return e.jsxs(P,{gap:2,paddingBottom:5,children:[e.jsx(Y,{variant:"epsilon",textColor:"neutral600",children:i({id:c("list.assets.selected"),defaultMessage:"{numberFolders, plural, one {1 folder} other {# folders}} - {numberAssets, plural, one {1 asset} other {# assets}} selected"},{numberFolders:s?.filter(({type:o})=>o==="folder").length,numberAssets:d})}),e.jsx(Us,{selected:s,onSuccess:n}),e.jsx(zs,{currentFolder:a,selected:s,onSuccess:n})]})},Gs=({isFiltering:s,canCreate:n,canRead:a})=>s?{id:"list.assets-empty.title-withSearch",defaultMessage:"There are no elements with the applied filters"}:a?n?{id:"list.assets.empty-upload",defaultMessage:"Upload your first assets..."}:{id:"list.assets.empty",defaultMessage:"Media Library is empty"}:{id:"header.actions.no-permissions",defaultMessage:"No permissions to view"},Ns=({canCreate:s,isFiltering:n,canRead:a,onActionClick:i})=>{const{formatMessage:d}=C(),o=Gs({isFiltering:n,canCreate:s,canRead:a});return e.jsx(us,{icon:a?void 0:gs,action:s&&!n&&e.jsx(S,{variant:"secondary",startIcon:e.jsx(K,{}),onClick:i,children:d({id:c("header.actions.add-assets"),defaultMessage:"Add new assets"})}),content:d({...o,id:c(o.id)})})},qs=()=>{const[s,n]=M.useState(!1),{formatMessage:a}=C(),{trackUsage:i}=be(),[{query:d},o]=T(),u=d?.filters?.$and||[],h=l=>{o({filters:{$and:l},page:1})},f=l=>{i("didFilterMediaLibraryElements",{location:"content-manager",filter:Object.keys(l[l.length-1])[0]}),o({filters:{$and:l},page:1})};return e.jsxs(ge.Root,{open:s,onOpenChange:n,children:[e.jsx(ge.Trigger,{children:e.jsx(S,{variant:"tertiary",startIcon:e.jsx(fs,{}),size:"S",children:a({id:"app.utils.filters",defaultMessage:"Filters"})})}),e.jsx(hs,{displayedFilters:fe,filters:u,onSubmit:f,onToggle:n}),e.jsx(ps,{appliedFilters:u,filtersSchema:fe,onRemoveFilter:h})]})},Hs=({breadcrumbs:s=null,canCreate:n,folder:a=null,onToggleEditFolderDialog:i,onToggleUploadAssetDialog:d})=>{const{formatMessage:o}=C(),{pathname:u}=je(),[{query:h}]=T(),f={...h,folder:a?.parent&&typeof a.parent!="number"&&a.parent.id?a.parent.id:void 0,folderPath:a?.parent&&typeof a.parent!="number"&&a.parent.path?a.parent.path:void 0};return e.jsx(I.Header,{title:o({id:c("plugin.name"),defaultMessage:"Media Library"}),subtitle:s&&typeof s!="boolean"&&a&&e.jsx(ms,{label:o({id:c("header.breadcrumbs.nav.label"),defaultMessage:"Folders navigation"}),breadcrumbs:s,currentFolderId:a?.id}),navigationAction:a&&e.jsx(xs,{tag:js,startIcon:e.jsx(bs,{}),to:`${u}?${Me.stringify(f,{encode:!1})}`,children:o({id:c("header.actions.folder-level-up"),defaultMessage:"Back"})}),primaryAction:n&&e.jsxs(P,{gap:2,children:[e.jsx(S,{startIcon:e.jsx(K,{}),variant:"secondary",onClick:i,children:o({id:c("header.actions.add-folder"),defaultMessage:"Add new folder"})}),e.jsx(S,{startIcon:e.jsx(K,{}),onClick:d,children:o({id:c("header.actions.add-assets"),defaultMessage:"Add new assets"})})]})})},_s=J($)`
  height: 3.2rem;
  display: flex;
  align-items: center;
`,me=J(Y)`
  max-width: 100%;
`,xe=J($)`
  svg {
    path {
      fill: ${({theme:s})=>s.colors.neutral500};
    }
  }
`,Ws=()=>{const s=Ue(),{canRead:n,canCreate:a,canUpdate:i,canCopyLink:d,canDownload:o,canConfigureView:u,isLoading:h}=Ve(),f=M.useRef(),{formatMessage:l}=C(),{pathname:g}=je(),{trackUsage:j}=be(),[{query:r},v]=T(),p=!!(r._q||r.filters),[E,Ce]=Qe(ys.view,D.GRID),k=E===D.GRID,{data:b,isLoading:Fe,error:ve}=ze({skipWhen:!n,query:r}),{data:Se,isLoading:ke,error:Le}=Oe({enabled:n&&b?.pagination?.page===1&&!Ge(r),query:r}),{data:U,isLoading:X,error:we}=Ne(r?.folder,{enabled:n&&!!r?.folder});we?.name==="NotFoundError"&&s(g);const R=Se?.map(t=>({...t,type:"folder",folderURL:A(g,r,{folder:t.id.toString(),folderPath:t.path}),isSelectable:i}))??[],m=R?.length||0,B=b?.results?.map(t=>({...t,type:"asset",isSelectable:i}))||[],x=B?.length??0,Ae=b?.pagination?.total,Ee=X||ke||h||Fe,[Z,Re]=M.useState(!1),[ee,se]=M.useState(!1),[V,Q]=M.useState(void 0),[z,te]=M.useState(void 0),[F,{selectOne:O,selectAll:ae}]=qe(["type","id"],[]),ne=F?.length>0&&F?.length!==x+m,G=()=>Re(t=>!t),ie=({created:t=!1}={})=>{t&&r?.page!=="1"&&v({...r,page:1}),se(w=>!w)},oe=(t,w)=>{t&&j("didSelectAllMediaLibraryElements"),ae(w)},re=t=>{j("didSortMediaLibraryElements",{location:"upload",sort:t}),v({sort:t})},le=t=>{te(t),se(!0)},Be=t=>{te(null),ie(t),f.current&&f.current.focus()},de=t=>{t===x&&b?.pagination?.page===b?.pagination?.pageCount&&b?.pagination?.page&&b.pagination.page>1&&v({...r,page:b.pagination.page-1})},De=()=>{ae(),de(F.length)};return Ee?e.jsx(L.Loading,{}):ve||Le?e.jsx(L.Error,{}):e.jsxs(I.Root,{children:[e.jsxs(L.Main,{children:[e.jsx(Hs,{breadcrumbs:X?null:$s(U,{pathname:g,query:r}),canCreate:a,onToggleEditFolderDialog:ie,onToggleUploadAssetDialog:G,folder:U}),e.jsx(I.Action,{startActions:e.jsxs(e.Fragment,{children:[i&&k&&(x>0||m>0)&&e.jsx(_s,{paddingLeft:2,paddingRight:2,background:"neutral0",hasRadius:!0,borderColor:"neutral200",children:e.jsx(ye,{"aria-label":l({id:c("bulk.select.label"),defaultMessage:"Select all folders & assets"}),checked:ne?"indeterminate":(x>0||m>0)&&F.length===x+m,onCheckedChange:t=>oe(t,[...B,...R])})}),n&&k&&e.jsx(He,{value:r?.sort,onChangeSort:re}),n&&e.jsx(qs,{})]}),endActions:e.jsxs(e.Fragment,{children:[u?e.jsx(xe,{paddingTop:1,paddingBottom:1,children:e.jsx(q,{tag:_e,to:{pathname:`${g}/configuration`,search:Me.stringify(r,{encode:!1})},label:l({id:"app.links.configure-view",defaultMessage:"Configure the view"}),children:e.jsx(We,{})})}):null,e.jsx(xe,{paddingTop:1,paddingBottom:1,children:e.jsx(q,{label:l(k?{id:c("view-switch.list"),defaultMessage:"List View"}:{id:c("view-switch.grid"),defaultMessage:"Grid View"}),onClick:()=>Ce(k?D.LIST:D.GRID),children:k?e.jsx(Ke,{}):e.jsx(Je,{})})}),e.jsx(Ye,{label:l({id:c("search.label"),defaultMessage:"Search for an asset"}),trackedEvent:"didSearchMediaLibraryElements",trackedEventDetails:{location:"upload"}})]})}),e.jsxs(I.Content,{children:[F.length>0&&e.jsx(Os,{currentFolder:U,selected:F,onSuccess:De}),m===0&&x===0&&e.jsx(Ns,{canCreate:a,canRead:n,isFiltering:p,onActionClick:G}),n&&!k&&(x>0||m>0)&&e.jsx(Xe,{assetCount:x,folderCount:m,indeterminate:ne,onChangeSort:re,onChangeFolder:(t,w)=>s(A(g,r,{folder:t.toString(),folderPath:w})),onEditAsset:Q,onEditFolder:le,onSelectOne:O,onSelectAll:oe,rows:[...R,...B],selected:F,shouldDisableBulkSelect:!i,sortQuery:r?.sort??""}),n&&k&&e.jsxs(e.Fragment,{children:[m>0&&e.jsx(Ze,{title:(p&&x>0||!p)&&l({id:c("list.folders.title"),defaultMessage:"Folders ({count})"},{count:m})||"",children:R.map(t=>{const Ie=!!F.filter(({type:N})=>N==="folder").find(N=>N.id===t.id),ce=A(g,r,{folder:t?.id.toString(),folderPath:t?.path});return e.jsx(W.Item,{col:3,direction:"column",alignItems:"stretch",children:e.jsx(es,{ref:z&&t.id===z.id?f:void 0,ariaLabel:t.name,id:`folder-${t.id}`,to:ce,startAction:t.isSelectable?e.jsx(Ps,{"data-testid":`folder-checkbox-${t.id}`,checked:Ie,onCheckedChange:()=>O(t)}):null,cardActions:e.jsx(q,{label:l({id:c("list.folder.edit"),defaultMessage:"Edit folder"}),onClick:()=>le(t),children:e.jsx(ss,{})}),children:e.jsx(ts,{children:e.jsx(as,{to:ce,children:e.jsxs(P,{tag:"h2",direction:"column",alignItems:"start",maxWidth:"100%",children:[e.jsxs(me,{fontWeight:"semiBold",textColor:"neutral800",ellipsis:!0,children:[t.name,e.jsx(ns,{children:":"})]}),e.jsx(me,{tag:"span",textColor:"neutral600",variant:"pi",ellipsis:!0,children:l({id:c("list.folder.subtitle"),defaultMessage:"{folderCount, plural, =0 {# folder} one {# folder} other {# folders}}, {filesCount, plural, =0 {# asset} one {# asset} other {# assets}}"},{folderCount:t.children?.count,filesCount:t.files?.count})})]})})})})},`folder-${t.id}`)})}),x>0&&m>0&&e.jsx($,{paddingTop:6,paddingBottom:4,children:e.jsx(is,{})}),x>0&&e.jsx(os,{assets:B,onEditAsset:Q,onSelectAsset:O,selectedAssets:F.filter(({type:t})=>t==="asset"),title:(!p||p&&m>0)&&b?.pagination?.page===1&&l({id:c("list.assets.title"),defaultMessage:"Assets ({count})"},{count:Ae})||""})]}),e.jsxs(H.Root,{...b?.pagination,children:[e.jsx(H.PageSize,{}),e.jsx(H.Links,{})]})]})]}),Z&&e.jsx(rs,{open:Z,onClose:G,trackedLocation:"upload",folderId:r?.folder}),ee&&e.jsx(ls,{open:ee,onClose:()=>Be(),folder:z,parentFolderId:r?.folder,location:"upload"}),V&&e.jsx(ds,{onClose:t=>{t===null&&de(1),Q(void 0)},open:!!V,asset:V,canUpdate:i,canCopyLink:d,canDownload:o,trackedLocation:"upload"})]})},Ks=M.lazy(async()=>Te(()=>import("./ConfigureTheView-BuULTlH7-BJsSUXWG.js"),__vite__mapDeps([0,1,2])).then(s=>({default:s.ConfigureTheView}))),Ys=()=>{const{config:{isLoading:s,isError:n,data:a}}=$e(),[{rawQuery:i},d]=T(),{formatMessage:o}=C(),u=o({id:c("plugin.name"),defaultMessage:"Media Library"});return M.useEffect(()=>{s||n||i||d({sort:a.sort,page:1,pageSize:a.pageSize})},[s,n,a,i,d]),s?e.jsxs(e.Fragment,{children:[e.jsx(L.Title,{children:u}),e.jsx(L.Loading,{})]}):e.jsx(L.Main,{children:i?e.jsx(M.Suspense,{fallback:e.jsx(L.Loading,{}),children:e.jsxs(Pe,{children:[e.jsx(ue,{index:!0,element:e.jsx(Ws,{})}),e.jsx(ue,{path:"configuration",element:e.jsx(Ks,{config:a})})]})}):null})};export{Ys as Upload};
